{"version":3,"file":"index.mjs","sources":["../src/i18n.mjs","../src/with-i18n.mjs"],"sourcesContent":["class I18n {\n  constructor () {\n    if (globalThis.__ficusjs__ && globalThis.__ficusjs__.i18n) {\n      return globalThis.__ficusjs__.i18n\n    }\n    this.registry = {}\n    this.currentLocale = 'en'\n    this.interpolateRE = /{{\\s*(\\w+)\\s*}}/g\n    this.pluralizationRules = {\n      en: {\n        pluralizeTo: 'count',\n        getVariationIndex (count) {\n          return (count === 1) ? 0 : 1\n        }\n      }\n    }\n    this._init()\n    globalThis.__ficusjs__ = globalThis.__ficusjs__ || {}\n    globalThis.__ficusjs__.i18n = globalThis.__ficusjs__.i18n || this\n  }\n\n  _init () {\n    if (typeof window !== 'undefined' && typeof document !== 'undefined') {\n      const paramLang = new URLSearchParams(window.location.search).get('lang')\n      const lang = !paramLang ? (document.documentElement.lang ? document.documentElement.lang : navigator.language) : paramLang\n      if (lang) this.setLocale(lang)\n    }\n  }\n\n  _translatePlural (key, variations, data, locale, pluralizeTo) {\n    const rule = this.pluralizationRules[locale]\n    const dataKeys = Object.keys(data)\n    const pluralizeKey = dataKeys.length === 1\n      ? dataKeys[0]\n      : (pluralizeTo || rule.pluralizeTo)\n    const count = parseFloat(data[pluralizeKey])\n    if (isNaN(count)) {\n      throw new Error(`Translation pluralization missing parameters on key '${key}'`)\n    } else {\n      return this._interpolate(variations[rule.getVariationIndex(count)], data)\n    }\n  }\n\n  _interpolate (translationString, data) {\n    return data\n      ? translationString.replace(this.interpolateRE, function (match, param) {\n          return data[param] != null ? data[param] : match\n        })\n      : translationString\n  }\n\n  t (key, templateData, options) {\n    options = options || {}\n    const locale = options.locale || this.currentLocale\n    const store = options.registry || this.registry\n    const translation = store[locale] && store[locale][key]\n    if (typeof translation === 'undefined') {\n      return this.whenUndefined(key, locale)\n    } else if (Array.isArray(translation)) {\n      return this._translatePlural(key, translation, templateData, locale, options.pluralizeTo)\n    } else {\n      return this._interpolate(translation, templateData)\n    }\n  }\n\n  add (items, locale, prefix) {\n    locale = locale || this.currentLocale\n    this.registry[locale] = this.registry[locale] || {}\n    Object.keys(items).forEach(key => {\n      const value = items[key]\n      const registryKey = prefix ? prefix + '.' + key : key\n      const valueType = typeof value\n      if (Array.isArray(value) || valueType === 'string' || valueType === 'number') {\n        this.registry[locale][registryKey] = value\n      } else {\n        this.add(value, locale, registryKey)\n      }\n    })\n    return this\n  }\n\n  setLocale (locale) {\n    this.currentLocale = locale\n    return this\n  }\n\n  getLocale () {\n    return this.currentLocale\n  }\n\n  interpolateWith (userRE) {\n    this.interpolateRE = userRE\n    return this\n  }\n\n  setPluralizationRule (locale, rule, options) {\n    this.pluralizationRules[locale] = {\n      pluralizeTo: options && (options.pluralizeTo || 'count'),\n      getVariationIndex: rule\n    }\n    return this\n  }\n\n  whenUndefined (key, locale) {\n    return key\n  }\n\n  clear () {\n    this.registry = {}\n    return this\n  }\n}\n\n/**\n * Function to create an I18n instance\n * @returns {I18n}\n */\nexport function createI18n () {\n  return new I18n()\n}\n\n/**\n * Function to get the running I18n instance\n * @returns {I18n}\n */\nexport function getI18n () {\n  return createI18n()\n}\n","export function withI18n (i18n, options) {\n  return {\n    ...options,\n    created () {\n      this.setI18n(i18n)\n      if (options.created) options.created.call(this)\n    },\n    setI18n (i18n) {\n      const self = this\n      self._i18n = i18n\n      self.i18n = {\n        t (key, templateData, options) {\n          return self._i18n.t(key, templateData, options)\n        },\n        getLocale () {\n          return self._i18n.getLocale()\n        },\n        setLocale (locale) {\n          self._i18n.setLocale(locale)\n        }\n      }\n    }\n  }\n}\n\nexport function withI18nReactive (i18n, options) {\n  return withI18n(i18n, {\n    ...options,\n    created () {\n      if (this.eventBus) {\n        this.eventBus.subscribe('i18n:locale:changed', lng => {\n          this.key = lng\n        })\n      }\n      if (options.created) options.created.call(this)\n    }\n  })\n}\n"],"names":["I18n","constructor","globalThis","__ficusjs__","i18n","this","registry","currentLocale","interpolateRE","pluralizationRules","en","pluralizeTo","getVariationIndex","count","_init","window","document","paramLang","URLSearchParams","location","search","get","lang","documentElement","navigator","language","setLocale","_translatePlural","key","variations","data","locale","rule","dataKeys","Object","keys","pluralizeKey","length","parseFloat","isNaN","Error","_interpolate","translationString","replace","match","param","t","templateData","options","store","translation","whenUndefined","Array","isArray","add","items","prefix","forEach","value","registryKey","valueType","getLocale","interpolateWith","userRE","setPluralizationRule","clear","createI18n","getI18n","withI18n","created","setI18n","call","self","_i18n","withI18nReactive","eventBus","subscribe","lng"],"mappings":"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"}