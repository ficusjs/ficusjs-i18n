{"version":3,"file":"with-i18n.mjs","sources":["../src/with-i18n.mjs"],"sourcesContent":["export function withI18n (i18n, options) {\n  return {\n    ...options,\n    created () {\n      this.setI18n(i18n)\n      if (options.created) options.created.call(this)\n    },\n    setI18n (i18n) {\n      const self = this\n      self._i18n = i18n\n      self.i18n = {\n        t (key, templateData, options) {\n          return self._i18n.t(key, templateData, options)\n        },\n        getLocale () {\n          return self._i18n.getLocale()\n        },\n        setLocale (locale) {\n          self._i18n.setLocale(locale)\n        },\n        detectLocale (callback) {\n          self._i18n.detectLocale(callback)\n        }\n      }\n    }\n  }\n}\n\nexport function withI18nReactive (i18n, options) {\n  return withI18n(i18n, {\n    ...options,\n    created () {\n      if (this.eventBus) {\n        this.eventBus.subscribe('i18n:locale:changed', locale => {\n          // Function that returns an array of all ancestor elements\n          const getAncestorElements = elem => elem.parentElement\n            ? [elem.parentElement].concat(getAncestorElements(elem.parentElement))\n            : []\n\n          // Find the context's locale, i.e. that of the nearest ancestor with a\n          // 'lang' attribute, or 'undefined' if none exists\n          const contextLocale = getAncestorElements(this)\n            .find(elem => elem.hasAttribute('lang'))?.getAttribute('lang')\n\n          // Set the 'lang' attribute on this element if not already set and if\n          // different than the context's\n          const currentLocale = this.i18n.getLocale()\n          if (currentLocale === contextLocale) {\n            this.removeAttribute('lang')\n          } else {\n            this.setAttribute('lang', currentLocale)\n          }\n\n          this.key = locale\n        })\n      }\n\n      if (options.created) options.created.call(this)\n    }\n  })\n}\n"],"names":["withI18n","i18n","options","created","this","setI18n","call","self","_i18n","t","key","templateData","getLocale","setLocale","locale","detectLocale","callback","withI18nReactive","eventBus","subscribe","getAncestorElements","elem","parentElement","concat","contextLocale","find","hasAttribute","getAttribute","currentLocale","removeAttribute","setAttribute"],"mappings":"AAAO,SAASA,SAAUC,EAAMC,GAC9B,MAAO,IACFA,EACH,OAAAC,GACEC,KAAKC,QAAQJ,GACTC,EAAQC,SAASD,EAAQC,QAAQG,KAAKF,KAC3C,EACD,OAAAC,CAASJ,GACP,MAAMM,EAAOH,KACbG,EAAKC,MAAQP,EACbM,EAAKN,KAAO,CACVQ,EAAE,CAACC,EAAKC,EAAcT,IACbK,EAAKC,MAAMC,EAAEC,EAAKC,EAAcT,GAEzCU,UAAU,IACDL,EAAKC,MAAMI,YAEpB,SAAAC,CAAWC,GACTP,EAAKC,MAAMK,UAAUC,EACtB,EACD,YAAAC,CAAcC,GACZT,EAAKC,MAAMO,aAAaC,EACzB,EAEJ,EAEL,CAEO,SAASC,iBAAkBhB,EAAMC,GACtC,OAAOF,SAASC,EAAM,IACjBC,EACH,OAAAC,GACMC,KAAKc,UACPd,KAAKc,SAASC,UAAU,uBAAuBL,IAE7C,MAAMM,oBAAsBC,GAAQA,EAAKC,cACrC,CAACD,EAAKC,eAAeC,OAAOH,oBAAoBC,EAAKC,gBACrD,GAIEE,EAAgBJ,oBAAoBhB,MACvCqB,MAAKJ,GAAQA,EAAKK,aAAa,WAAUC,aAAa,QAInDC,EAAgBxB,KAAKH,KAAKW,YAC5BgB,IAAkBJ,EACpBpB,KAAKyB,gBAAgB,QAErBzB,KAAK0B,aAAa,OAAQF,GAG5BxB,KAAKM,IAAMI,CAAM,IAIjBZ,EAAQC,SAASD,EAAQC,QAAQG,KAAKF,KAC3C,GAEL"}