{"version":3,"file":"i18n.mjs","sources":["../src/i18n.mjs"],"sourcesContent":["class I18n {\n  constructor () {\n    if (globalThis.__ficusjs__ && globalThis.__ficusjs__.i18n) {\n      return globalThis.__ficusjs__.i18n\n    }\n    this.registry = {}\n    this.currentLocale = 'en'\n    this.interpolateRE = /{{\\s*(\\w+)\\s*}}/g\n    this.localeDetectionRule = () =>\n      new URLSearchParams(globalThis?.window?.location?.search).get('lang')\n    this.pluralizationRules = {\n      en: {\n        pluralizeTo: 'count',\n        getVariationIndex (count) {\n          return (count === 1) ? 0 : 1\n        }\n      }\n    }\n    this.detectLocale()\n    globalThis.__ficusjs__ = globalThis.__ficusjs__ || {}\n    globalThis.__ficusjs__.i18n = globalThis.__ficusjs__.i18n || this\n  }\n\n  _translatePlural (key, variations, data, locale, pluralizeTo) {\n    const rule = this.pluralizationRules[locale]\n    const dataKeys = Object.keys(data)\n    const pluralizeKey = dataKeys.length === 1\n      ? dataKeys[0]\n      : (pluralizeTo || rule.pluralizeTo)\n    const count = parseFloat(data[pluralizeKey])\n    if (isNaN(count)) {\n      throw new Error(`Translation pluralization missing parameters on key '${key}'`)\n    } else {\n      return this._interpolate(variations[rule.getVariationIndex(count)], data)\n    }\n  }\n\n  _interpolate (translationString, data) {\n    return data\n      ? translationString.replace(this.interpolateRE, function (match, param) {\n        return data[param] != null ? data[param] : match\n      })\n      : translationString\n  }\n\n  t (key, templateData, options) {\n    options = options || {}\n    const locale = options.locale || this.currentLocale\n    const registry = options.registry || this.registry\n    const translation = registry[locale] && registry[locale][key]\n    if (typeof translation === 'undefined') {\n      return this.whenUndefined(key, locale)\n    } else if (Array.isArray(translation)) {\n      return this._translatePlural(key, translation, templateData, locale, options.pluralizeTo)\n    } else {\n      return this._interpolate(translation, templateData)\n    }\n  }\n\n  add (items, locale, prefix) {\n    locale = locale || this.currentLocale\n    this.registry[locale] = this.registry[locale] || {}\n    Object.keys(items).forEach(key => {\n      const value = items[key]\n      const registryKey = prefix ? prefix + '.' + key : key\n      const valueType = typeof value\n      if (Array.isArray(value) || valueType === 'string' || valueType === 'number') {\n        this.registry[locale][registryKey] = value\n      } else {\n        this.add(value, locale, registryKey)\n      }\n    })\n    return this\n  }\n\n  setLocale (locale) {\n    // Allow validation and re-writing of the local string\n    const newLocale = this.whenChangingLocale(locale)\n\n    // Do not update locale if new value is null or undefined\n    if (newLocale != null) {\n      this.currentLocale = newLocale\n    }\n\n    return this\n  }\n\n  getLocale () {\n    return this.currentLocale\n  }\n\n  detectLocale (callback = () => {}) {\n    // Rely in fallback detection methods if new locale is null or undefined\n    const setLocale = locale => {\n      const oldLocale = this.currentLocale\n      this.setLocale(locale !== undefined && locale !== null\n        ? locale\n        : globalThis?.document?.documentElement?.lang ||\n          globalThis?.navigator?.language\n      )\n      callback(this.currentLocale, oldLocale)\n    }\n\n    // Execute the user-defined locale detection rule\n    const detected = this.localeDetectionRule()\n    if (detected instanceof Promise) {\n      detected.then(setLocale)\n    } else {\n      setLocale(detected)\n    }\n\n    return this\n  }\n\n  setLocaleDetectionRule (rule) {\n    this.localeDetectionRule = typeof rule === 'function'\n      ? rule\n      : () => rule\n    return this\n  }\n\n  interpolateWith (userRE) {\n    this.interpolateRE = userRE\n    return this\n  }\n\n  setPluralizationRule (locale, rule, options) {\n    this.pluralizationRules[locale] = {\n      pluralizeTo: options && (options.pluralizeTo || 'count'),\n      getVariationIndex: rule\n    }\n    return this\n  }\n\n  whenChangingLocale (locale) {\n    return locale\n  }\n\n  whenUndefined (key, locale) {\n    return key\n  }\n\n  clear () {\n    this.registry = {}\n    return this\n  }\n}\n\n/**\n * Function to create an I18n instance\n * @returns {I18n}\n */\nexport function createI18n () {\n  return new I18n()\n}\n\n/**\n * Function to get the running I18n instance\n * @returns {I18n}\n */\nexport function getI18n () {\n  return createI18n()\n}\n"],"names":["I18n","constructor","globalThis","__ficusjs__","i18n","this","registry","currentLocale","interpolateRE","localeDetectionRule","URLSearchParams","window","location","search","get","pluralizationRules","en","pluralizeTo","getVariationIndex","count","detectLocale","_translatePlural","key","variations","data","locale","rule","dataKeys","Object","keys","pluralizeKey","length","parseFloat","isNaN","Error","_interpolate","translationString","replace","match","param","t","templateData","options","translation","whenUndefined","Array","isArray","add","items","prefix","forEach","value","registryKey","valueType","setLocale","newLocale","whenChangingLocale","getLocale","callback","oldLocale","document","documentElement","lang","navigator","language","detected","Promise","then","setLocaleDetectionRule","interpolateWith","userRE","setPluralizationRule","clear","createI18n","getI18n"],"mappings":"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"}